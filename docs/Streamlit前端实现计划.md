# Streamlit å‰ç«¯å®ç°è®¡åˆ’

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†å°†å‰ç«¯ä» React + TypeScript è¿ç§»åˆ° Streamlit çš„å®ç°è®¡åˆ’ã€‚

## ğŸ¯ ç›®æ ‡

ä½¿ç”¨ Streamlit æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç”¨æˆ·å‹å¥½çš„æµ·æµªç¯å¢ƒæ¨¡å‹å¯è§†åŒ–å‰ç«¯ï¼ŒåŒ…æ‹¬ï¼š

1. å‚æ•°é…ç½®ç•Œé¢
2. åŒºåŸŸæ¨¡æ‹Ÿå¯è§†åŒ–
3. å•ç‚¹æŸ¥è¯¢åŠŸèƒ½
4. æ—¶é—´åºåˆ—æ’­æ”¾æ§åˆ¶

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Streamlit UI   â”‚  (å‰ç«¯ï¼Œè¿è¡Œåœ¨ localhost:8501)
â”‚   - å‚æ•°é…ç½®      â”‚
â”‚   - å¯è§†åŒ–        â”‚
â”‚   - äº¤äº’æ§åˆ¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP (REST API)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI Backendâ”‚  (åç«¯ï¼Œè¿è¡Œåœ¨ localhost:8000)
â”‚   - æ¨¡æ‹ŸæœåŠ¡      â”‚
â”‚   - æŸ¥è¯¢æœåŠ¡      â”‚
â”‚   - æ•°æ®ç®¡ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯é€‰å‹

- **å‰ç«¯æ¡†æ¶**: Streamlit
- **è¯­è¨€**: Python 3.8
- **å¯è§†åŒ–åº“**:
  - **Plotly**: äº¤äº’å¼å›¾è¡¨å’Œçƒ­åŠ›å›¾ï¼ˆä¸»è¦ï¼‰
  - **Folium**: åœ°ç†åœ°å›¾æ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰
  - **Matplotlib**: é™æ€å›¾è¡¨ï¼ˆå¤‡ç”¨ï¼‰
- **HTTP å®¢æˆ·ç«¯**: httpxï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰
- **çŠ¶æ€ç®¡ç†**: Streamlit session_state

## ğŸ“¦ æ¨¡å—è®¾è®¡

### 1. å‚æ•°é…ç½®æ¨¡å—

**ä½ç½®**: `frontend/app.py` - ä¾§è¾¹æ 

**åŠŸèƒ½**:
- åŒºåŸŸé…ç½®ï¼ˆç»çº¬åº¦èŒƒå›´ã€æ·±åº¦ï¼‰
- é£åœºå‚æ•°ï¼ˆé£é€Ÿã€é£å‘ã€å‚è€ƒé«˜åº¦ï¼‰
- æ³¢æµªè°±å‚æ•°ï¼ˆæ¨¡å‹ç±»å‹ã€æ˜¾è‘—æ³¢é«˜ã€å³°å€¼å‘¨æœŸã€ä¸»æµªå‘ã€æ–¹å‘æ‰©æ•£ï¼‰
- ç¦»æ•£åŒ–å‚æ•°ï¼ˆdx, dy, max_pointsï¼‰
- æ—¶é—´å‚æ•°ï¼ˆdt_backend, T_totalï¼‰

**å®ç°æ–¹å¼**:
```python
with st.sidebar:
    st.header("å‚æ•°é…ç½®")
    
    # åŒºåŸŸé…ç½®
    st.subheader("åŒºåŸŸè®¾ç½®")
    lon_min = st.number_input("æœ€å°ç»åº¦", value=120.0)
    # ... å…¶ä»–å‚æ•°
    
    # é£åœºé…ç½®
    st.subheader("é£åœºå‚æ•°")
    wind_speed = st.slider("é£é€Ÿ (m/s)", 0.0, 40.0, 10.0)
    # ... å…¶ä»–å‚æ•°
```

### 2. API å®¢æˆ·ç«¯æ¨¡å—

**ä½ç½®**: `frontend/utils/api_client.py`ï¼ˆæ–°å»ºï¼‰

**åŠŸèƒ½**:
- å°è£…åç«¯ API è°ƒç”¨
- é”™è¯¯å¤„ç†
- è¯·æ±‚é‡è¯•æœºåˆ¶

**å®ç°æ–¹å¼**:
```python
import httpx
from typing import Optional

BACKEND_URL = "http://localhost:8000"

class APIClient:
    def __init__(self, base_url: str = BACKEND_URL):
        self.base_url = base_url
        self.client = httpx.AsyncClient(timeout=30.0)
    
    async def create_simulation(self, request_data: dict) -> dict:
        """åˆ›å»ºåŒºåŸŸæ¨¡æ‹Ÿä»»åŠ¡"""
        response = await self.client.post(
            f"{self.base_url}/api/simulate/area",
            json=request_data
        )
        response.raise_for_status()
        return response.json()
    
    async def get_frames(self, simulation_id: str, **kwargs) -> dict:
        """è·å–æ¨¡æ‹Ÿç»“æœå¸§"""
        # ...
    
    async def query_point(self, request_data: dict) -> dict:
        """å•ç‚¹æŸ¥è¯¢"""
        # ...
```

### 3. å¯è§†åŒ–æ¨¡å—

**ä½ç½®**: `frontend/utils/visualization.py`ï¼ˆæ–°å»ºï¼‰

**åŠŸèƒ½**:
- æµ·æµªé«˜åº¦åœºçƒ­åŠ›å›¾
- æ—¶é—´åºåˆ—åŠ¨ç”»
- åœ°å›¾æ˜¾ç¤º

**å®ç°æ–¹å¼**:
```python
import plotly.graph_objects as go
import plotly.express as px
import numpy as np

def create_wave_heatmap(lon_grid, lat_grid, height_grid, time_idx: int):
    """åˆ›å»ºæµ·æµªé«˜åº¦çƒ­åŠ›å›¾"""
    fig = go.Figure(data=go.Contour(
        x=lon_grid[0],
        y=lat_grid[:, 0],
        z=height_grid[time_idx],
        colorscale='Viridis',
        colorbar=dict(title="æµ·æµªé«˜åº¦ (m)")
    ))
    fig.update_layout(
        title=f"æµ·æµªé«˜åº¦åœº - t = {time_idx * dt:.2f} s",
        xaxis_title="ç»åº¦ (Â°)",
        yaxis_title="çº¬åº¦ (Â°)"
    )
    return fig
```

### 4. ä¸»åº”ç”¨æµç¨‹

**ä½ç½®**: `frontend/app.py`

**é¡µé¢å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Streamlit åº”ç”¨                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¾§è¾¹æ         â”‚  ä¸»å†…å®¹åŒº                  â”‚
â”‚              â”‚                          â”‚
â”‚  å‚æ•°é…ç½®      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  - åŒºåŸŸ       â”‚  â”‚  åœ°å›¾/å¯è§†åŒ–åŒºåŸŸ      â”‚  â”‚
â”‚  - é£åœº       â”‚  â”‚                    â”‚  â”‚
â”‚  - æ³¢æµªè°±     â”‚  â”‚  [Plotly å›¾è¡¨]      â”‚  â”‚
â”‚  - ç¦»æ•£åŒ–     â”‚  â”‚                    â”‚  â”‚
â”‚  - æ—¶é—´       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                          â”‚
â”‚  [å¼€å§‹æ¨¡æ‹Ÿ]   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚              â”‚  â”‚  æ§åˆ¶é¢æ¿            â”‚  â”‚
â”‚              â”‚  â”‚  [æ’­æ”¾] [æš‚åœ] [é‡ç½®] â”‚  â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                          â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚              â”‚  â”‚  å•ç‚¹æŸ¥è¯¢           â”‚  â”‚
â”‚              â”‚  â”‚  åæ ‡è¾“å…¥/åœ°å›¾ç‚¹å‡»   â”‚  â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å®ç°æ­¥éª¤

### é˜¶æ®µ 1: åŸºç¡€æ¡†æ¶æ­å»º âœ…

- [x] åˆ›å»º Streamlit åº”ç”¨åŸºç¡€ç»“æ„
- [x] é…ç½®ä¾èµ–æ–‡ä»¶
- [x] åˆ›å»ºå ä½é¡µé¢

### é˜¶æ®µ 2: API å®¢æˆ·ç«¯å®ç°

- [ ] åˆ›å»º `utils/api_client.py`
- [ ] å®ç° API è°ƒç”¨å°è£…
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- [ ] æµ‹è¯• API è¿æ¥

### é˜¶æ®µ 3: å‚æ•°é…ç½®ç•Œé¢

- [ ] å®ç°ä¾§è¾¹æ å‚æ•°é…ç½®
- [ ] åŒºåŸŸå‚æ•°è¾“å…¥
- [ ] é£åœºå‚æ•°è¾“å…¥
- [ ] æ³¢æµªè°±å‚æ•°è¾“å…¥
- [ ] ç¦»æ•£åŒ–å’Œæ—¶é—´å‚æ•°è¾“å…¥
- [ ] å‚æ•°éªŒè¯å’Œé»˜è®¤å€¼

### é˜¶æ®µ 4: æ¨¡æ‹Ÿä»»åŠ¡ç®¡ç†

- [ ] å®ç°"å¼€å§‹æ¨¡æ‹Ÿ"æŒ‰é’®
- [ ] è°ƒç”¨åç«¯ API åˆ›å»ºæ¨¡æ‹Ÿä»»åŠ¡
- [ ] æ˜¾ç¤ºä»»åŠ¡çŠ¶æ€ï¼ˆè¿è¡Œä¸­/å®Œæˆ/å¤±è´¥ï¼‰
- [ ] è¿›åº¦æ¡æ˜¾ç¤º
- [ ] é”™è¯¯æç¤º

### é˜¶æ®µ 5: å¯è§†åŒ–å®ç°

- [ ] å®ç°æ•°æ®è½¬æ¢ï¼ˆAPI å“åº” â†’ å¯è§†åŒ–æ•°æ®ï¼‰
- [ ] åˆ›å»ºçƒ­åŠ›å›¾ç»„ä»¶
- [ ] å®ç°æ—¶é—´åºåˆ—æ’­æ”¾
- [ ] æ·»åŠ é¢œè‰²æ˜ å°„ï¼ˆcolorbarï¼‰
- [ ] ä¼˜åŒ–æ€§èƒ½ï¼ˆå¤§æ•°æ®é‡å¤„ç†ï¼‰

### é˜¶æ®µ 6: å•ç‚¹æŸ¥è¯¢åŠŸèƒ½

- [ ] å®ç°åæ ‡è¾“å…¥ç•Œé¢
- [ ] åœ°å›¾ç‚¹å‡»æŸ¥è¯¢ï¼ˆå¦‚æœä½¿ç”¨ Foliumï¼‰
- [ ] è°ƒç”¨æŸ¥è¯¢ API
- [ ] æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
- [ ] æŸ¥è¯¢å†å²è®°å½•

### é˜¶æ®µ 7: äº¤äº’æ§åˆ¶

- [ ] æ’­æ”¾/æš‚åœæ§åˆ¶
- [ ] æ—¶é—´æ»‘å—
- [ ] é€Ÿåº¦æ§åˆ¶
- [ ] é‡ç½®åŠŸèƒ½

### é˜¶æ®µ 8: ä¼˜åŒ–å’Œæµ‹è¯•

- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€å¼‚æ­¥åŠ è½½ï¼‰
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ–‡æ¡£å®Œå–„

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### çŠ¶æ€ç®¡ç†

ä½¿ç”¨ Streamlit çš„ `st.session_state` ç®¡ç†åº”ç”¨çŠ¶æ€ï¼š

```python
if 'simulation_id' not in st.session_state:
    st.session_state.simulation_id = None

if 'frames' not in st.session_state:
    st.session_state.frames = []

if 'current_time_idx' not in st.session_state:
    st.session_state.current_time_idx = 0
```

### å¼‚æ­¥å¤„ç†

å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„æ¨¡æ‹Ÿä»»åŠ¡ï¼Œä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼š

```python
import asyncio

async def run_simulation(params):
    # è°ƒç”¨ API
    result = await api_client.create_simulation(params)
    # è·å–ç»“æœ
    frames = await api_client.get_frames(result['simulation_id'])
    return frames

# åœ¨ Streamlit ä¸­ä½¿ç”¨
if st.button("å¼€å§‹æ¨¡æ‹Ÿ"):
    with st.spinner("æ­£åœ¨è¿è¡Œæ¨¡æ‹Ÿ..."):
        frames = asyncio.run(run_simulation(params))
        st.session_state.frames = frames
```

### æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®ç¼“å­˜**: ä½¿ç”¨ `@st.cache_data` ç¼“å­˜ API å“åº”
2. **å¢é‡åŠ è½½**: åˆ†é¡µåŠ è½½æ¨¡æ‹Ÿç»“æœå¸§
3. **å¼‚æ­¥è¯·æ±‚**: ä½¿ç”¨ httpx å¼‚æ­¥å®¢æˆ·ç«¯
4. **æ•°æ®å‹ç¼©**: åç«¯è¿”å›æ—¶è¿›è¡Œæ•°æ®å‹ç¼©

### é”™è¯¯å¤„ç†

```python
try:
    result = await api_client.create_simulation(params)
except httpx.HTTPStatusError as e:
    st.error(f"API é”™è¯¯: {e.response.status_code} - {e.response.text}")
except httpx.RequestError as e:
    st.error(f"è¿æ¥é”™è¯¯: {str(e)}")
except Exception as e:
    st.error(f"æœªçŸ¥é”™è¯¯: {str(e)}")
```

## ğŸ“Š æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥å‚æ•°
    â†“
Streamlit UI (ä¾§è¾¹æ )
    â†“
æ„å»ºè¯·æ±‚æ•°æ® (Pydantic Schema)
    â†“
HTTP POST /api/simulate/area
    â†“
åç«¯å¤„ç† (FastAPI)
    â†“
è¿”å› simulation_id
    â†“
HTTP GET /api/simulation/{id}/frames
    â†“
è·å–æ¨¡æ‹Ÿç»“æœå¸§
    â†“
æ•°æ®è½¬æ¢ (JSON â†’ NumPy)
    â†“
å¯è§†åŒ– (Plotly)
    â†“
æ˜¾ç¤ºåœ¨ Streamlit UI
```

## ğŸ¨ UI/UX è®¾è®¡

### å¸ƒå±€

- **ä¾§è¾¹æ **: å‚æ•°é…ç½®ï¼ˆå›ºå®šå®½åº¦ï¼Œå¯æŠ˜å ï¼‰
- **ä¸»åŒºåŸŸ**: 
  - é¡¶éƒ¨ï¼šæ ‡é¢˜å’ŒçŠ¶æ€ä¿¡æ¯
  - ä¸­é—´ï¼šå¯è§†åŒ–å›¾è¡¨ï¼ˆå ä¸»è¦ç©ºé—´ï¼‰
  - åº•éƒ¨ï¼šæ§åˆ¶é¢æ¿å’ŒæŸ¥è¯¢åŒºåŸŸ

### äº¤äº’

- **å‚æ•°ä¿®æ”¹**: å®æ—¶æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°
- **æ¨¡æ‹Ÿå¯åŠ¨**: æ˜¾ç¤ºè¿›åº¦æ¡å’ŒçŠ¶æ€
- **æ’­æ”¾æ§åˆ¶**: æµç•…çš„æ—¶é—´åºåˆ—æ’­æ”¾
- **æŸ¥è¯¢åé¦ˆ**: å³æ—¶æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ

### å“åº”å¼è®¾è®¡

- ä½¿ç”¨ Streamlit çš„ `layout="wide"` æ¨¡å¼
- å›¾è¡¨è‡ªé€‚åº”å®¹å™¨å¤§å°
- ç§»åŠ¨ç«¯å‹å¥½ï¼ˆStreamlit è‡ªåŠ¨é€‚é…ï¼‰

## ğŸš€ éƒ¨ç½²è€ƒè™‘

### å¼€å‘ç¯å¢ƒ

- å‰ç«¯: `streamlit run app.py`
- åç«¯: `uvicorn app.main:app --reload`

### ç”Ÿäº§ç¯å¢ƒ

- ä½¿ç”¨ Streamlit Cloud æˆ–è‡ªæ‰˜ç®¡
- åç«¯éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨æˆ–å®¹å™¨
- é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåç«¯ URL ç­‰ï¼‰

## ğŸ“š å‚è€ƒèµ„æ–™

- [Streamlit æ–‡æ¡£](https://docs.streamlit.io/)
- [Plotly Python æ–‡æ¡£](https://plotly.com/python/)
- [FastAPI æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [httpx æ–‡æ¡£](https://www.python-httpx.org/)

## âœ… æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹å®ç°å‰ï¼Œç¡®ä¿ï¼š

- [x] åç«¯ API å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡
- [x] äº†è§£ Streamlit åŸºæœ¬ç”¨æ³•
- [x] äº†è§£ Plotly å¯è§†åŒ–
- [x] äº†è§£å¼‚æ­¥ HTTP è¯·æ±‚
- [ ] è®¾è®¡å¥½æ•°æ®æµå’ŒçŠ¶æ€ç®¡ç†
- [ ] å‡†å¤‡å¥½æµ‹è¯•æ•°æ®

---

**æœ€åæ›´æ–°**: 2024å¹´
**çŠ¶æ€**: è§„åˆ’é˜¶æ®µ

