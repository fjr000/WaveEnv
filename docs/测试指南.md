# åç«¯æœåŠ¡æµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•æµ‹è¯•æµ·æµªç¯å¢ƒæ¨¡å‹åç«¯æœåŠ¡çš„å„é¡¹åŠŸèƒ½ã€‚

## ğŸš€ å¯åŠ¨æœåŠ¡

### æ–¹å¼1ï¼šä½¿ç”¨ uvicorn ç›´æ¥å¯åŠ¨

```bash
cd backend
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥è®¿é—®ï¼š
- API æ–‡æ¡£ï¼šhttp://127.0.0.1:8000/docs
- æ ¹è·¯å¾„ï¼šhttp://127.0.0.1:8000/
- å¥åº·æ£€æŸ¥ï¼šhttp://127.0.0.1:8000/health

### æ–¹å¼2ï¼šä½¿ç”¨ Python æ¨¡å—å¯åŠ¨

```bash
cd backend
python -m uvicorn app.main:app --reload
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. ä½¿ç”¨ API æ–‡æ¡£æµ‹è¯•ï¼ˆæ¨èï¼‰

1. å¯åŠ¨æœåŠ¡åï¼Œè®¿é—® http://127.0.0.1:8000/docs
2. åœ¨ Swagger UI ä¸­å¯ä»¥ç›´æ¥æµ‹è¯•å„ä¸ª API ç«¯ç‚¹
3. ç‚¹å‡» "Try it out" æŒ‰é’®ï¼Œå¡«å†™å‚æ•°ï¼Œç‚¹å‡» "Execute"

### 2. ä½¿ç”¨æµ‹è¯•è„šæœ¬

#### åŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆä¸å¯åŠ¨HTTPæœåŠ¡å™¨ï¼‰

```bash
python backend/test_service.py
```

è¿™ä¸ªè„šæœ¬ä¼šç›´æ¥æµ‹è¯•æ ¸å¿ƒæœåŠ¡æ¨¡å—ï¼Œä¸éœ€è¦å¯åŠ¨HTTPæœåŠ¡å™¨ã€‚

#### API ç«¯ç‚¹æµ‹è¯•ï¼ˆéœ€è¦å¯åŠ¨æœåŠ¡ï¼‰

```bash
# å…ˆå¯åŠ¨æœåŠ¡ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼‰
uvicorn app.main:app --reload

# ç„¶åè¿è¡Œæµ‹è¯•è„šæœ¬
python tests/backend/manual_test.py
```

### 3. ä½¿ç”¨ pytestï¼ˆå¦‚æœå·²å®‰è£…ï¼‰

```bash
cd backend
pytest ../tests/backend/test_basic.py -v
pytest ../tests/backend/test_api.py -v
```

## ğŸ“ æµ‹è¯•ç”¨ä¾‹è¯´æ˜

### åŸºç¡€åŠŸèƒ½æµ‹è¯• (`test_basic.py`)

æµ‹è¯•æ ¸å¿ƒæœåŠ¡æ¨¡å—ï¼š
- âœ… é£åœºåˆ›å»º
- âœ… é£åœºåˆ†é‡è®¡ç®—
- âœ… æ³¢æµªè°±ç”Ÿæˆï¼ˆPMå…‰è°±ï¼‰
- âœ… åæ ‡è½¬æ¢ï¼ˆç»çº¬åº¦ â†” æœ¬åœ°åæ ‡ï¼‰
- âœ… ç½‘æ ¼åˆ›å»º

### API ç«¯ç‚¹æµ‹è¯• (`test_api.py`)

æµ‹è¯• HTTP APIï¼š
- âœ… æ ¹è·¯å¾„ (`GET /`)
- âœ… å¥åº·æ£€æŸ¥ (`GET /health`)
- âœ… åˆ›å»ºæ¨¡æ‹Ÿä»»åŠ¡ (`POST /api/simulate/area`)
- âœ… è·å–æ¨¡æ‹Ÿç»“æœ (`GET /api/simulation/{id}/frames`)
- âœ… å•ç‚¹æŸ¥è¯¢ (`POST /api/query/point`)
- âœ… é”™è¯¯å¤„ç†ï¼ˆæ— æ•ˆIDç­‰ï¼‰

## ğŸ” æ‰‹åŠ¨æµ‹è¯•ç¤ºä¾‹

### 1. æµ‹è¯•åˆ›å»ºæ¨¡æ‹Ÿä»»åŠ¡

```bash
curl -X POST "http://127.0.0.1:8000/api/simulate/area" \
  -H "Content-Type: application/json" \
  -d '{
    "region": {
      "lon_min": 120.0,
      "lat_min": 35.0,
      "depth_min": 10.0,
      "lon_max": 120.1,
      "lat_max": 35.1,
      "depth_max": 20.0
    },
    "wind": {
      "wind_speed": 10.0,
      "wind_direction_deg": 270.0
    },
    "spectrum": {
      "spectrum_model_type": "PM",
      "Hs": 2.0,
      "Tp": 8.0
    },
    "discretization": {
      "dx": 0.01,
      "dy": 0.01,
      "max_points": 100
    },
    "time": {
      "dt_backend": 0.2,
      "T_total": 1.0
    }
  }'
```

### 2. æµ‹è¯•è·å–æ¨¡æ‹Ÿç»“æœ

```bash
# ä½¿ç”¨ä¸Šé¢è¿”å›çš„ simulation_id
curl "http://127.0.0.1:8000/api/simulation/{simulation_id}/frames"
```

### 3. æµ‹è¯•å•ç‚¹æŸ¥è¯¢

```bash
curl -X POST "http://127.0.0.1:8000/api/query/point" \
  -H "Content-Type: application/json" \
  -d '{
    "simulation_id": "{simulation_id}",
    "lon": 120.05,
    "lat": 35.05,
    "time": 0.5
  }'
```

## âœ… é¢„æœŸç»“æœ

### åˆ›å»ºæ¨¡æ‹Ÿä»»åŠ¡
- çŠ¶æ€ç ï¼š201
- è¿”å›ï¼š`{"simulation_id": "...", "status": "completed"}`

### è·å–æ¨¡æ‹Ÿç»“æœ
- çŠ¶æ€ç ï¼š200
- è¿”å›ï¼šåŒ…å« `frames` æ•°ç»„ï¼Œæ¯ä¸ªå¸§åŒ…å«æ—¶é—´ã€åŒºåŸŸå’Œç‚¹åˆ—è¡¨

### å•ç‚¹æŸ¥è¯¢
- çŠ¶æ€ç ï¼š200
- è¿”å›ï¼š`{"simulation_id": "...", "time": 0.5, "lon": 120.05, "lat": 35.05, "wave_height": ...}`

## ğŸ› å¸¸è§é—®é¢˜

### 1. æœåŠ¡æ— æ³•å¯åŠ¨
- æ£€æŸ¥æ˜¯å¦å®‰è£…äº†ä¾èµ–ï¼š`pip install -e backend/`
- æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨

### 2. å¯¼å…¥é”™è¯¯
- ç¡®ä¿åœ¨ `backend` ç›®å½•ä¸‹è¿è¡Œï¼Œæˆ–æ­£ç¡®è®¾ç½® PYTHONPATH
- æ£€æŸ¥ `backend/app` ç›®å½•ç»“æ„æ˜¯å¦æ­£ç¡®

### 3. æ¨¡æ‹Ÿä»»åŠ¡å¤±è´¥
- æ£€æŸ¥åŒºåŸŸèŒƒå›´æ˜¯å¦åˆç†ï¼ˆlon_min < lon_max, lat_min < lat_maxï¼‰
- æ£€æŸ¥å‚æ•°æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ğŸ“Š æ€§èƒ½æµ‹è¯•å»ºè®®

å¯¹äºå¤§åŒºåŸŸæ¨¡æ‹Ÿï¼Œå»ºè®®ï¼š
- ä½¿ç”¨è¾ƒå°çš„ `max_points` è¿›è¡Œæµ‹è¯•
- ä½¿ç”¨è¾ƒçŸ­çš„ `T_total` è¿›è¡Œå¿«é€ŸéªŒè¯
- é€æ­¥å¢åŠ å‚æ•°æµ‹è¯•æ€§èƒ½

## ğŸ”„ æŒç»­æµ‹è¯•

å»ºè®®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼š
1. æ¯æ¬¡ä¿®æ”¹ä»£ç åè¿è¡ŒåŸºç¡€åŠŸèƒ½æµ‹è¯•
2. å¯åŠ¨æœåŠ¡åä½¿ç”¨ API æ–‡æ¡£è¿›è¡Œå¿«é€ŸéªŒè¯
3. å®šæœŸè¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶

---

**æç¤º**ï¼šæ‰€æœ‰æµ‹è¯•è„šæœ¬éƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„æµ‹è¯•æ¡†æ¶ã€‚


